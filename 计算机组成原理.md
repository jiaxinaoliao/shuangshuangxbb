# 计算机组成原理

## 第一章 计算机系统概述

### 1.1 计算机发展历程

人类生产分为传统生产和现代生产

硬件是计算机的物质基础，软件的作用是发挥计算机的功能

二者缺一不可



#### 1.1.1 古代计算机阶段

算盘中算盘算是物理硬件使用算盘的口诀是软件同时算盘本身也可以存储数字

#### 1.1.2 现代计算机阶段

现代计算工具包括，计算理论和架构模型

+ 计算理论指的是二进制计算方法、布尔代数理论、
+ 架构指的是冯·诺依曼计算机模型

世界第一台计算机诞生于1946年美国宾夕法尼亚大学的“埃尼阿克（ENIAC）”占地170平方米、重30吨

一秒钟进行5000次加法运算和500次乘法运算

从此计算机发展分为四个阶段

+ 第一阶段：硬件技术以电子管为主，外部设备有磁鼓，卡片机，纸带穿孔机等，主要以手编机器码程序为主
+ 第二阶段：世界第一台晶体管计算机是贝尔实验室为美国空军研制，1962年我国第一台自行设计研制的晶体管计算机每秒运算速度10万次以上
+ 第三阶段：使用集成电路、大容量的内存和外存、分时技术以及其他新技术的计算机，称为集成电路计算机，速度在每秒几百万到几千万次运算
+ 第四阶段：大规模集成电路计算机，性能上有较大发展

产生了哈佛结构的计算机



### 1.2 计算机层次结构

#### 1.2.1 计算机硬件基本组成及特点

初代计算机由，运算器、控制器、存储器和输入输出五个功能组成其中

+ 运算器用来完成数据的暂存、变换、逻辑运算和算数运算
+ 控制器完成对计算机的各部分的协同行动的指挥控制保证了命令的次序、步骤，并且能够处理突发事件
+ 存储器则是存储计算机运行过程中所要执行的指令代码和数据
+ 输入设备的主要功能就是想计算机输送用户数据
+ 输出设备就是把运算结构输出给用户

冯·诺依曼计算机结构属于典型的单指令流单数据流的系统有以下特点

+ 计算机内部以运算器为中心，输入输出与存储器的数据传送都要经过运算器，各部分的操作和联系由控制器控制
+ 采用存储器程序原理，将程序和数据事先存放在存储器中，运行时顺序取出指令一条一条的执行
+ 指令在存储器中基本是按执行顺序依次存储的
+ 指令由操作码和地址码两部分组成，操作码指明操作类型，地址码指明本指令所在的地址
+ 数据以二进制进行编码，并采用二进制进行运算
+ 软硬件完全分开，硬件应用固定的逻辑结构，依靠不同的软件来适应不同的需要



#### 1.2.2 计算机的软件及其分类

计算机资源分为硬件资源和软件资源

软件资源主要解决两个问题，一是解决计算机自身自身资源管理问题，二是完成计算机语言和机器语言的转换问题，然后是完成用户的一般任务，完成自身管理和计算机语言转换的问题称为系统软件

而完成用户的一般问题称为应用软件，系统软件包括

+ 管理系统资源的操作系统
+ 各类语言和解释的翻译软件
+ 数据库管理软件
+ 网络软件
+ 系统服务软件

应用软件包括

+ 按用户需求所编制的各种程序



计算机的语言分为

+ 机器语言
+ 汇编语言
+ 高级语言

使用机器语言编写的程序可以直接被硬件识别和运行，但由于难以记忆不常用

汇编语言是对机器语言的一种符号化处理，优点是便于使用记忆和理解但需要转换成机器语言

高级语言又称算法语言，侧重于描述解决实际问题所用的算法，更多的是为了方便人员使用，一般需要进行翻译成机器语言或解释之后才能在计算机上执行



#### 1.2.3 计算机系统的层次结构

在遇到大型任务时可以用“分而治之”的方法

可将问题分为若干小问题然后逐一解决

可以抽象想成若干层次，每个层次都有一个特定功能，通常称为虚拟计算机（virtual machine）

| 层次序号 | 层次名称 | 工作内容 |
| -------- | -------- | -------- |
| 第五层   | 高级语言层 | C++、Java、FORTRAN等 |
|第四层|汇编语言层|汇编代码|
|第三层|操作系统软件层|操作系统、代码库|
|第二层|指令系统层|指令构架|
|第一层|微体系结构层|微代码和硬件连接|
|第零层|数字逻辑层|电路、逻辑门等|

汇编语言一对一翻译一条对应一条机器语言

计算机中有些事情可以直接用硬件实现处理速度高，也可以用软件实现降低成本




### 1.3 计算机的分类及应用

#### 1.3.1 计算机的分类

按计算机的信息表现形式和处理方式分为

+ 数字计算机：一般都是0,1表示的二进制数
+ 模拟计算机：连续变化的电信号
+ 混合计算机：

按不同用途分

+ 通用计算机
+ 专用计算机

按处理速度分

+ 巨型机：又称超级计算机速度超过每秒1亿次的计算机
+ 大中型机：一般用于商业管处理，信息管理
+ 小型机：体积小，价格低一般用于中小型企业也可作为大型机的辅助
+ 微型机：一般个人使用，普及量产的一款，也可细分有个人计算机，单片机，单板机等
+ 工作站： 通常用于微型机和小型机之间
+ 服务器：server一种可供网络用户共享的高性能计算机



#### 1.3.2 计算机的应用领域

主要表现在六个方面

1. 科学计算：利用计算机来完成科学研究和工程技术中提出的数学问题进行计算

2. 数据处理：是指对各种数据进行收集、存储、整理、分类、统计、加工等据统计80%以上的计算机用于数据处理

3. 计算机辅助技术

   （1）计算机辅助技术（Computer Aided Design CAD）是利用计算机进行辅助设计人员的工程或产品设计

   （2）计算机辅助制造（Manufacturing CAM）是利用计算机对生产的管理控制和操作的过程

   （3）计算机辅助教学（Instruction CAI）利用课件进行教学，课件可以用高级语言开发制作

4. 过程控制：利用计算机采集数据，按最优值进行调整或控制提高效率和准确性

5. 人工智能：

6. 网络应用：传输共享



### 1.4 计算机性能指标

计算机的时间性能如下

1. 主频/时钟周期：CPU的工作主频，单位是MHz或GHz主频f的倒数称为T周期单位是微秒、纳秒

2. CPU的执行时间：表示CPU执行一般程序所需要的时间 

   CPU的执行时间=CPU时钟周期XCPU时钟周期

3. CPI：表示执行某段程序中的一条指令所需的平均时钟周期数

   CPI=程序所需总的时钟周期数/程序所包含的指令条数

4. 吞吐量：表征一台计算机在某一时间间隔内能够处理的信息量

5. 响应时间：表征从输入有效到系统产生响应之间的时间度量、用时间单位表示

6. 存储器带宽：单位时间内从存储器读出的二进制数信息量，一般用字节数/秒表示

   常用的计量单位MIPS、MFLOPS

   + MIPS：=（指令数/10^6^）除以程序执行时间
   + MFLOPS：每秒百万次浮点操作数

空间度量

1. 处理机字长：处理机的运算器中一次能够完成二级制数运算的位数，如32位，64位
2. 总线宽度：一般指CPU中运算器与存储器之间进行互连的内部总线位数
3. 存储容量：中所有存储单元的总数目，通常用KB，MB，GB，TB表示

利用率也是一大指标



计算机的层次中四五级为软件级其余为硬件级

   

## 第二章 计算机中数据信息的表示和运算

### 2.1 数制与编码

计算机处理用二进制，存储地址又用十六机制，人们又用十进制所以需要进制转换



#### 2.1.1 进位计数制及其转换

1. 进位计数制
2. 进制转换



#### 2.1.2 数值数据的编码与表示

1. 真数与机器数

   人们使用的数有正负称为真值，在计算机存储中把符号也用数码存储在计算机中称为机器数

   （1）源码表示法

   最高位用来表示符号

   最大表示数为2^n-1^-1个数

   （2）补码表示法

   便于计算机进行加减操作

   00000000~11111111一共256即2^8^为模，在计算机中若计算数值超过模则会被抛弃

   补码最高位是符号位，其符号位可以直接进行运算，源码和补码进行转换时符号位不动将其余位取反后加1

   （3）反码表示法

   对于正数源码、反码、补码形式相同，负数则是取反

   （4）移码表示法

   移码也叫增码，常以整数形式用在计算机中浮点数的阶码中 

   移码和补码形式相同符号位相反

   （5）无符号未表示

2. 机内数值数据和信息的表示

   （1）采用数字化的表示方法有以下有点

   + 抗干扰能力强
   + 位数增多则数的表示范围扩大

   BCD（Binary Coded Decimal）常用的有8421和余3码即在8421的基础上加3

   （2）字符与字符串的表示

   ASCII中一共有128个代码95个编码（包含26个字母以及0-9和符号）可以被人们使用其余33个是控制码，控制计算机的某些连接设备和显示状态一般用一个字节表示一个ASCII值

   常用的字符集还有BCDIC用八位二进制数表示一个字符有256个字符与ASCII有一定对应关系

   （3）汉字的处理

   1. 在1981年颁布《通讯用汉字字符集（基本集）及其交换码》简称国标码，汉字编码用两个字节进行表示，后来又采用一字节，2字节，4字节来表示
   2. 汉子输入是利用英文键盘，由于汉字过多无法一一对应所以需要几个键共同输入来表示称为汉字的输入编码。一般分为三类
      + 数字编码：难以记忆使用
      + 字音编码：简单易学
      + 字形编码：输入速度快，重码少
   3. 汉字的输出：目前有两种一种是点阵字形描述另一种是轮廓字形，汉字的输出形式有打印和显示两种
   4. 图形、图像信息在机内的表示形式



#### 2.1.3 校验码

为了纠正数据在传输存储的时候产生的错误

1. 目前提出的方法基本上是用“冗余校验”的思想，即在有效信息之外再扩充几位，扩充的部分称为校验位，并提出了码距的概念

   如BCD的6（0110）和7（0111）中间码距就是1，而7和8（1000）码距就是4，将各码制的最小的码距称为码制的码距BCD的码距就为1

2. 奇偶校验的方法：工作原理就是每个码字上面添加一个奇偶校验位P（取值“0”或“1”）取决于字码中1 的个数，但是只能进行检查错误不能纠错

3. 循环冗余校验方法：（Cyclic Redundancy Check，CRC）是通过某种数学运算来建立起信息位和检验位之间的约定的关系，由于这种校验需要增加的冗余位比较多所以码距比较大，不仅能检查错误还能纠错，CRC编码形式过程中采用的加、减运算都是按位加减，即不考虑进位和借位关系，如果传输正确，则除以G(X)后余数应为0，如果不为零则出现了错误



### 2.2 定点数的表示和运算

数值包括整数和小数部分但是计算机不能显示小数点而是采用隐含方式规定小数点的位置，根据小数点位置是否固定可以表示为定点数和浮点数
对于定点数有带有符号定点整数、带符号定点小数和无符号定点整数三种形式




#### 2.2.1 定点数的表示

在计算机中将小数点位置固定不变的数称为定点数

1. 带符号定点整数形式

   最高位为符号位小数点默认在最后

2. 带符号定点小数形式

   将小数点固定在最高数值位和符号位之间

3. 无符号定点整数形式

   没有符号位的整数



#### 2.2.2 定点数的运算

计算机中各种复杂的运算处理都可以根据算法分解成四则运算或基本逻辑运算，而四则运算最终都可以归结为加法和位移操作

1. 定点加、减运算

   + 计算机采用补码的形式进行运算包括符号位一起只要没有超过机器能表示的范围就能得到结果基本规则如下

   1. 参与运算的操作数用补码表示，符号位参与运算得到的结果是补码形式
   2. 若操作码为相加则两数直接相加，若操作码为减，则将减数求补（机器负数）后再与被减数相加

   

2. 溢出判断与位移

   1. 溢出判断方法

      + 定点数表示的范围有限如果运算结果超出则称为溢出判断方法有单符号法和双符号法

        1. 单符号位判断法

           当任意两个带符号的数相加时，当最高数值位的进位C~f~与符号位进位C~s~同时产生进位或者都没有产生进位，则没有溢出，如果两者不同则产生溢出

        2. 双符号位判断法

           由于一位只能表示正负产生溢出时符号位会混乱所以采用双位判断也称为变形补码的方法
        
           00表示正号、01表示正向溢出、11表示负号、10表示负向溢出
   
   2. 移位操作
   
      位移是算数、逻辑运算的又一种基本操作，几乎所有机器指令系统中都设置有各类移位操作指令。
   
      （1） 逻辑位移
   
      在逻辑位移中数字代码具有纯逻辑代码，可以实现串-并转换和并-串转换
   
      （2）算数位移
   
      在算数位移中符号位不变，正数数值不变空位补0，负数左移补0右移补1
   
      （3）舍入处理
   
      1. 0舍1入：右移过程中若0不变1在最低位加1
      2. 末位恒1：不管0或1都将最后一位置1
   
   3. 定点乘法运算与实现方案
   
      计算机的乘法运算可以在ALU等硬件的基础上，在结合软件编程的方式实现，目前速度更快的列阵乘法都是硬件实现
   
      （1）定点原码一位乘法的运算与实现方案
   
       在计算机实现乘法的过程中要应用三个寄存器A、B、C分别存放积、被乘数和乘数
   
      + 机器内一次加法操作只能进行两数之和的运算，因此每求得一个相加数就要与上次部分积相加
      + 在人工计算时，相加数逐次向左偏移一位，这样最后的乘机位数是乘数（或被乘数）的两倍
      + 部分积右移时乘数寄存器要与其同时右移一位
   
      （2）定点补码一位乘法运算
   
      + 机器中经常采用补码的形式来表现数据，因此采用补码的形式进行乘法
      + 实现乘法的形式有校正法和比较法
   
      （3）阵列乘法器
   
      在计算机内可以通过硬件逻辑进行多次加法和多次移位来实现的
   
      但是速度慢为了提高运算速度采用的是类似人工计算的方法使用一个阵列乘法器完成乘法运算
   
   4. 定点除法运算与实现方案
   
      （1）定点原码不恢复余数除法运算与实现方案
   
      + 除数≠0,；定点小数时，被除数<除数；定点整数时，被除数＞除数
      + 原码除法商的符号等于被除数的符号与除数的符号相异或（单独电路完成）
   
      （2）定点补码除法的实现方案
   
      （3）阵列除法器
   
      

### 2.3 浮点数的表示和运算

为了更加灵活又有相对的精度，提出了浮点表示



#### 2.3.1 浮点数的表示

利用科学计数法将小数点用2^E^进行调整

1. 浮点数的表示格式

   采用由指数和尾数来表示实数，指数位越多表示的范围越大，尾数位越多表示的精度越高

   所以要合理分配指数和小数

2. 浮点数的规格化

   为了尽可能的的提高精度

   （1）用原码表示尾数时不论正数和负数都应1/2≤|D|＜1，

   （2）用补码表示尾数时正数1/2≤D＜1，负数则-1/2≤D＜-1，

3. 溢出问题

   当一个浮点数的阶码大于机器的最大阶码时称为上溢，小于最小时称为下溢，一般上溢之后就不能再继续计算了，一般要中断处理，下溢时可以继续运算当做零处理

4. IEEE754标准浮点数格式

   浮点数的表示和运算在机器中是由浮点运算器FPU完成的。IEEE754标准将浮点数分为单精度32位，双精度64位，以及扩展精度80位



#### 2.3.2 浮点数的运算

1. 浮点数的加减运算

   

2. 浮点数的乘数运算



### 2.4 算数逻辑单元ALU

在计算机中，运算部件主要是由算数逻辑运算部件ALU、输入输出逻辑等部分组成



#### 2.4.1 串行进位加法器并行进位加法器

一位全加器只能对一位数据求和，如果要将两个多位操作数相加就需要多位全加器组成多位加法器来实现

1. 串行进位加法计算器

   n位串行进位加法器或行波进位加法器

2. 并性进位加法计算器

   为了提高多位加法器的工作速度

   

#### 2.4.2 多功能算数逻辑部件的结构

利用集成电路技术可将若干位全加器、并行进位链、输入选择电路等部分集成在一起称为多功能算数、逻辑运算部件ALU

1. ALU的组成与功能

   如SN74181四位算数逻辑部件

2. ALU的进位逻辑与级联扩展

   采用多片SN74181进行联级工作如采用两片则可构成8位的ALU



+ 在机器数中零的补码和移码的表示形式是唯一的



## 第三章 存储系统

### 3.1 存储系统概述

具有记忆功能，是存储程序、数据和运算结果的部件



#### 3.1.1 存储器的性能指标

存储器的性能指标主要有存储容量、存储时间、存储周期、价格和带宽等。一般将8个二进制位定义为一个字节也称字节存储单元，其地址称为字节地址。

+ 如果计算机按字节存储单元进行寻址，则称按字节编址的计算机
+ 如果是按字存储单元（多个字节）进行寻址，则称为按字编址的计算机

1. 存储容量是以字节（或字）为单位来表示存储器存储单元的总数
2. 存取时间又称存储器访问时间
3. 存储周期指的是启动两次独立的存储器操作中间所间隔的最小时间
4. 存储器的价格通常以每位的价格衡量
5. 存储器的带宽（频）是指单位时间内存储器所存取的信息量
   + 其他的性能还有可靠性、存储密度、长期性、功耗、物理尺寸等



#### 3.1.2 存储器分类

1. 按介质分

   + 半导体
   + 磁性材料
   + 光学存储

2. 安读写功能

   + 只读的存储器（ROM）
   + 能读写的称（RAM）称为随机存取存储器

3. 按保存性分

   + 断电后就消失的称为非永久记忆的存储器
   + 断电后还存在的称为永久性记忆的存储器

4. 按存储位置分

   + 存储器
     + 内存储器
       + RAM
         + SRAM
         + DRAM
       + ROM
         + ROM
         + EPROM
         + E^2^PROM
     + 外存储器
       + 内存（Flash Memory）
       + 磁盘（Disk）
         + 软盘（Floppy Disk)
         + 硬盘（Hard Disk）
       + 光盘（Optical Disk）
         + CD
         + DVD
         + MO



#### 3.1.3 存储系统的层次化结构

计算机对存储系统的要求是容量大、速度快、成本低。但是目前技术很难同时实现

所以通常采用三种不同类型的存储器即高速缓冲存储器Cache、主存储器（简称主存或内存）和外存储器（外存或辅存），形成一个层次化的二级存储结构层次，其中一个层次由主存和高速缓冲存储器Cache构成的高速缓冲存储系统另一个是由主存和辅存构成的虚拟存储系统，前一层解决速度问题后一层解决容量问题



### 3.2 主存储器

一般由半导体存储器件构成习惯称为内存



#### 3.2.1 主存储器概述

在计算机中主存一般由多个半导体存储芯片经过扩展后组成，这些芯片一般可按字节编制也可按字编制



#### 3.2.2 半导体随机存取存储器RAM

RAM中的数据即能被CPU读取也能写入，但是写入在断电后就消失

RAM按电路结构和存储结构分为静态RAM和动态RAM

静态利用的是触发器的工作原理来使用速度快无须刷新常用于高速缓冲存储

动态利用的是电容存储电荷的原理但是需要刷新否则会丢失，由于动态RAM集成度高、价格低、功耗小所以被广泛采用

1. 静态RAM（Static RAM，SRAM）
2. 动态RAM（Dymanic RAM，DRAM）



#### 3.2.3 半导体只读存储器ROM

用户在使用时能读取其中内容但是不能修改其中内容一般由生产商写入称为掩膜ROM

还有其他类型是ROM

1. 可编程ROM（Programmable ROM，PROM）一次性写入多次读取
2. 可擦除可编程ROM（Erasable Programmable ROM，EPROM）可用紫外线擦除
3. 电信号擦除可编程ROM（Electrically Erasable Programmable ROM，EEPROM）速度慢价格高
4. 闪速存储器（简称闪存，Flash Memory，FlashROM）优点多利用EPROM的结构和EEPROM的特点速度快容量大功耗低



#### 3.2.4 主存容量的扩展方式

1. 主存储器与CPU的连接原理

   （1）地址线的连接

   存储芯片的容量不同其地址线不同，CPU的地址线往往比存储芯片的多，一般是CPU的低位地址线与存储芯片相连

   （2）数据线的连接

   一般CPU的数据线位数多余存储芯片，必须要对存储芯片进行扩展位数使其相等

   （3）读/写命令线的连接

   CPU的读写一般与存储器直接相连一般高电平度低电平写

   （4）片选线的连接

   片选线的连接是计算机在存储器扩展时的关键

   通常用ROM存储系统程序、标准子程序和各类常数

   RAM存放CPU所需要的信息

2. 主存储容量的扩展方式

   主存储器的最基本访问单元由8位半导体存储器构成

   一般单个存储芯片无法满足实际机内主存系统容量要求通常需要扩展

   （1）位扩展方式

   当单个存储芯片的字数与主存储器的字数相同，而各个字中所存储的信息的位数小于主存储所要的位数时，可采用位扩展的方式来组织多个芯片满足主存储需求

   （2）字扩展方式

   位数相同字数扩展

   （3）字位同时扩展

   假设主存储需要MxN位可以用LxK的存储芯片扩展需要M/LxN/K个芯片

3. 存储器扩展中的译码方式

   （1）部分译码的方式

   当实际使用空间比CPU最大的要少时可以采用部分译码的方式

   （2）全译码的方式

   实际使用的存储空间与CPU可访问的最大存储空间相同或小于但对地址范围有严格要求



### 3.3 高速缓冲存储器Cache

存储系统中加入Cache的目的就是为了解决CPU和主存之间速度不匹配的问题

Cache是介于CPU和主存储之间的高速小容量的存储器，工作速度是主存储的数十倍内部功能全由硬件实现



#### 3.3.1 Cache的组成原理

为了提高CPU和主存之间的速度

1. 概述

   CPU对主存储和Cache的读写是以字为单位的，而Cache和主存之间的数据是按信息快为单位的，一个快是由若干的字或字节组成的，Cache中存放的总是部分主存储的副本

   在CPU访问Cache的时候需要地址映像将主存位置转换为Cache的地址，这一过程称为地址变换

   主存和Cache全部地址对应的关系的表格，称为地址映像表，该表用高速器件实现，以便提高查找速度。

   Cache分为两部分

   + 存储映像表内容（标记区
   + 信息快内地址

2. Cache的性能指标

   + 命中率
   + 平均存取时间
   + 访问效率
   + 加速比等

   

#### 3.3.2 Cache的地址映像方式

   Cache中存放的是主存中最急需执行的若干信息快的副本

   CPU在访问主存单元时先访问映像表判断Cache中是否有副本存在，若存在称为命中

   若不存在称为未命中还需CPU访问主存主存字信息快同时调入Cache中

   1. 直接映像方式

      要求各区存储容量都等同于Cache的存储容量

   2. 全相联映像方式

      可以允许主存中的每一信息快都可以映像到Cache中的任何位置，采用这种方式命中率最高

   3. n路组相联映像方式

      前两种的一种折中

   

#### 3.3.3 Cache的替换算法

1. 随机算法（RAND）

   从CAChe中随机取出一个信息快作为替换快，把新的信息快调入即可

2. 先进先出算法（FIFO）

   将最先调入的Cache信息快替换掉，可能会降低命中率

3. 近期最少使用算法（LRU）

   将长期未访问的信息块进行替换，符合程序访问局部性原理，提高了Cache的命中率



#### 3.3.4 Cache的更新（写）策略

度不需要更改但是写需要

1. 全写法

   在Cache命中后同时对Cache和主存进行写入

2. 回写法

   只修改Cache中的信息在要被替换时进行写入主存

   不过需要在Cache中添加标记位，修改过就置为1未修改就是0



#### 3.3.5 分体存储体系结构（哈佛体系结构）

1945年冯·诺依曼体系结构是指将程序指令和数据存储在一个存储体的不同位置

由于指令和数据同使用一总线

而哈佛结构将程序空间和数据空间分开为各自独立的存储体系



### 3.4 其他形式的高速存储器

（1）采取高速器件来尽可能缩短存储器的访问时间

（2）在CPU与主存储器中间加一级高速缓冲存储器Cache

（3）加长存储器字位长度

（4）采取并行主存系统

#### 3.4.1 双端口存储器

常规存储器都是单口存储器，每次只接收一个地址访问一个单元

增加一个读写口但是当两个口同时访问相同的地址时会冲突



#### 3.4.2 多模块交叉形式存储器

1. 单体多字并行存储器

   常规的主存储器指的是单体单字存储器，其内部只包含一个存储体，访问一次只能读写一次

2. 多体交叉并行存储器

   CPU访问多个存储体可以同时完成



#### 3.4.3 相联存储器

  计算机中查找存储信息的准则称为关键字，在RAM中地址是关键字

而相联存储器的关键字是按照所存的信息字的全部内容或部分内容进行产找的这个关键字是数据的一部分而不是地址。



### 3.5 虚拟存储器系统

虚拟存储器系统只是一个非常大的逻辑模型不是任何实际的物理存储器，借助辅助存储器来扩大主存容量，同时也需要辅助软硬件进行对数据的控制用户不用关心怎么使用存放的



#### 3.5.1 虚拟存储器概述

1. 虚拟存储器的功能和特点

   还是收到主存影响

   （1）允许用户访问比实际存储空间大得多的地址空间编制

   （2）可以将当前和常用到的内容自动从辅存调入存放在主存中，其他未用的可以调入辅存中

2. 虚拟存储器与Cache的比较

    主存-辅存乘次和Cache-主存层次之间有很多相似处

   不同点时间比大，基本信息单元大（段或页）Cache是（字块）



#### 3.5.2 虚拟存储器的管理方式与存储保护

1. 段式管理方式

   按程序段或数据段进行分配管理，但是容易造成空间浪费

2. 页式管理方式

   以指定长度的信息传送的存储页面为基本单位

   主存和辅存都要进行分页一般主存称为实际页或物理页，辅存称为虚页或逻辑页

3. 段页式管理方式

   物理空间分段段内分页相结合，缺点是要增加查表次数

4. 存储保护

   （1）存储区域保护

   + 段表和页表保护
   + 键保护
   + 环保护

   （2）访问方式保护

   对主存信息有读、写、执行（R、W、E）三种方式



#### 3.5.3 虚拟存储器的工作过程





### 3.6 辅助存储系统

容量大、成本低通常在断电后扔能保存信息



#### 3.6.1 辅助存储器概述

1. 存储密度

   是指单位长度或单位面积磁层表面所存储的二进制信息量

   位或道

2. 存储容量

   一般是字节为单位

3. 寻址时间

   时间越短表示工作速度越快

4. 数据传输率

5. 误码率

6. 价格



#### 3.6.2 磁表面存储器

1. 磁表面存储器工作原理

   磁表面存储器是利用磁性材料具有两种不同的磁化状态用来表示二进制的0或1将磁性材料均匀的涂抹在圆形的铝合金等载体上称为磁盘

   （1）归零制（RZ）

   正为1，负为0

   （2）不归零制（NRZ）

   连续写入时不需要改变电流方向

   （3）见1就翻的不归零（NRZ1)

   0无变化见1变换方向

   （4）调相制（PM）

   又称PE利用相差180°的磁化翻转方向代表数据0和1

   （5）调频制（FM）

   记录1时不仅在位周围的中心产生磁化翻转，而且在位与位之间也必须翻转。记录0时，位周期中心不产生磁化翻转，但位与位之间的边界处要翻转一次，也称倍频制

   （6）改进调频制（MFM）

   与FM的区别是只有在连续记录两个或两个以上的0时，才在位周期的起始位置翻转一次，而不是在每个位周期都翻转

2. 硬盘存储器

   硬磁盘是指记录介质为硬质的圆形盘片的磁表面存储器，故称为硬磁盘。

   硬磁盘主要由磁记录介质、磁盘控制器、磁盘驱动器三大部分组成

3. 磁盘阵列存储器

   （Redundant Arrays of Inexpensive Disk，RAID）是并行处理技术在磁盘系统中的应用。它把多台小型的磁盘存储器按一定的条件组织成同步化的阵列，利用类似于存储中的多体交叉技术，将数据展开存储在多台盘上。



#### 3.6.3 光盘存储器

1. 光盘的种类

   （1）只读型光盘

   （2）可记录光盘

2. 光盘的读写方式

   再光下凹坑表示1无凹坑表示0

3. 光盘存储器的组成

   由光盘盘片、光盘驱动器组成



#### 3.6.4 U盘存储器

基于USB接口无须驱动器的新一代存储设备



## 第四章 指令系统

### 4.1 指令系统概述

指令系统与计算机系统的运行性能、硬件结构等密切关联，是设计一台计算机的出发点

#### 4.1.1 指令与指令系统

（1）指令字：代表指令的一组二进制代码信息

（2）指令字长：即计算机字长，指计算机能直接处理的二进制数据的位数，他决定了计算机的运算精度

指令系统指的是一台计算机的所有指令的集合，即一台计算机所能执行的所有操作



#### 4.1.2 指令系统的性能要求

1. 完备性：要求指令系统丰富、功能齐全和编程方便
2. 高效性：利用该指令系统所编写的程序能高效的运行，占用内存空间小、运行速度快
3. 规整性：使用规则统一简单易学易用
4. 兼容性：完全兼容不可能但要求能向前兼容



### 4.2 指令格式

一般来说指令中包含操作的种类和性质、操作数存放的地址、操作结果的存放地址和下条指令存放的地址信息

（1）等长指令字结构：

各种指令字长度是相等的结构简单

（2）变长指令字结构：

各种指令因功能而异

通常一条指令由操作码（opcode）和操作数（operand）地址码两个字段组成

操作码表示要做什么

地址码告诉做的对象



#### 4.2.1 地址码字段的格式

不同的指令使用不同数目、不同来源于去向、不同用法的操作数，必须采用适当方式尽量把它们统一起来，并桉排在指令字的操作数地址码字段。

1. 三地址指令

   op A1 A2 A3

   op为操作码

   A1为源操作数1地址

   A2为源操作数2地址

   A3为目的地址（结果）

   A1（op）A2-----A3

2. 二地址指令

   称为双操作数指令是最常用的指令格式

   产生的结构可能存放在A1或A2中

   （1）存储器-存储器（SS）型，操作数都放在内存中从内存中某一单与取出在放入另一单元但是需要频繁访问内存

   （2）寄存器-寄存器（RR）型，需要多个通用寄存器或专用寄存器

   （3）寄存器-存储器（RS）型，既要访问内存又要访问寄存器

3. 一地址指令

   执行累加之类的操作，另一地址是隐含的或这个地址既是源操作数地址又是结果地址

4. 零地址指令

   也称无操作数指令 ，如关机等不需要操作数，第二种是默认操作数

目前系统中二地址和一地址指令比较常用



#### 4.2.2 操作码字段的格式

 不同的指令操作码，用不同的编码表示。

1. 定长操作码指令格式

   指的是操作码的位置和位数是固定的如八位2^8^=256即表示可以有256条指令

2. 扩展操作码指令格式

   指的是可变长度的操作码指令



#### 4.2.3 数据在存储器中的存放方式

计算机中操作类型有很多，可以按字、半字、字节等方式存放



### 4.3 寻址方式

寻址分为指令寻址和操作数寻址两大类

1. 指令寻址方式

   形成下一条要执行的指令地址的方式称为指令寻址方式

2. 操作数寻址方式

   计算机内的寻址方式有很多种



#### 4.3.1 立即数寻址

直接在指令中给出操作数，在取出指令同时取出操作数立即可以使用



#### 4.3.2 寄存器寻址

寄存器数目小速度快不用访问内存



#### 4.3.3 直接寻址

在指令中给出操作数的地址，但操作数地址不好修改



#### 4.3.4 寄存器间接寻址

在指令中给出寄存器编号，寄存器中存储操作数的地址

属于间接寻址，也是最基本、最常用的寻址方式之一



#### 4.3.5 存储器间接寻址

指令的地址中存放的是操作数的地址需要连续访问两次内存



#### 4.3.6 变址寻址

寄存器的的地址进行加减之后得到操作数地址



#### 4.3.7 基寻址

与变址寻址类似但是用法上有差别，基寻址是面向系统的主要用于逻辑地址到物理地址的变换



#### 4.3.8 相对寻址

是指把程序计数器PC的内容加上指令中给定形式的地址而形成的操作数地址，是一种跳跃指令寻址



#### 4.3.9 堆栈寻址

按照后进先出的原则进行存取

1. 寄存器堆栈

   一些计算机的CPU中有一组专门的寄存器，称为寄存器堆栈或硬堆栈，其中每一个堆栈能保存一个字的数据

2. 存储器堆栈

   利用主存储器的一部分空间作为堆栈称为存储器堆栈或软堆栈，这种堆栈可以具有任意长度



### 4.4 指令的类型

指令体系体现了计算机硬件所能实现的基本功能

#### 4.4.1 数据传送类指令

计算机中最基本的指令，进行数据移动



#### 4.4.2 算数/逻辑运算类指令

对数据进行运算的指令分为算数和逻辑两类

（1）算数运算指令

加减乘除比较等

（2）逻辑运算指令

与或非等基本逻辑和一些如异或等逻辑指令

（3）移位操作指令

左移右移等



#### 4.4.3 程序控制类指令

一般情况CPU按照顺序逐条执行程序中的指令，但有时需要改变这种顺序，程序类指令就是控制程序执行流程的，程序控制类指令分为无条件转移、条件转移、过程调用、返回以及陷阱等几种



#### 4.4.4 输入/输出类指令

输入输出也是一种数据传送，完成中央处理器和外部设备进行数据传输



#### 4.4.5 其他指令

除了典型的指令外还有一些控制处理的功能如（停机、等待、空操作等）



### 4.5 指令格式举例

不同机器的指令不同

1. 8位微型计算机的指令格式

   8位微型计算机的机器字长只有8位，其指令结构是一种可变字长形式，包含单子长、双字长、三字长等多种指令

2. PDP-11系列机的指令格式

   PDP-11系列机机器字长16位、指令字长有16位、32位、64位三种



### 4.6常用指令系统

常用的有两种

#### 4.6.1 复杂指令系统计算机

为了能兼容新的机器所以指令系统只能增加不能删减使指令系统越来越庞大，寻址方式各种各样十分繁多高达几百条称为复杂指令系统计算机（Complex Instruction Set Computer，CISC）例如Intel的80x86微处理器以及大中型计算机均为CISC



#### 4.6.2 精简指令系统计算机

（Reduce Instruction Set Computer，RISC）是近代计算机体系结构发展的一个里程碑，RISC指令系统是CISC指令系统的改进只保留简单基本功能，复杂功能用子程序代替

（1)选用使用频率较高的一些简单指令

（2）固定长度，寻址方式简单，格式统一

（3）只用取数/存数（LOAD/STORE）指令访问内存，其余指令的操作在寄存器之间进行

（4）CPU中的寄存器数量很多

（5）大部分指令可以单周期执行完成

（6）硬布线控制逻辑为主，不用或少用微码控制

（7）支持指令流水线

（8）一般用高级语言实现，重视编译优化，减少程序执行时间



## 第五章 中央处理单元CPU

CPU是计算机最核心的部分

### 5.1 CPU的功能和基本结构

#### 5.1.1 CPU的功能和性能

计算机的基本功能是执行程序，程序是用于完成某种运算处理功能的一个指令代码序列

CPU的基本功能分为

1. 指令控制：计算机的所有工作都可归纳为程序的运行，程序是指令是有序集合，这些指令在逻辑上的关系是固定的，CPU必须对指令的执行进行控制，以保证指令的正确执行
2. 操作控制：CPU在完成各条指令的执行时，分别需要几个操作步骤来完成，CPU必须能控制这些操作步骤
3. 时间控制：一条指令运行的各种操作信号在时间上有严格的要求
4. 数据处理：主要包括算数、逻辑、位移运算等
5. 异常处理：在CPU执行指令过程中有一些非正常情况进行及时处理

衡量CPU的性能一般将程序执行时间进行分解

（1）计算机的时钟评率

（2）平均指令执行时钟数

（3）程序执行的CPU时间



#### 5.1.2 CPU的基本组成结构

计算机由运算、控制、存储、输入输出五大部分组成

运算和控制部分合并称为中央处理器CPU随着现代计算机发展CPU原理上还是运算器和控制器和寄存器等组成

1. 运算器

   运算器是对计算机中数据进行加工处理的部件内部包含算数逻辑单元（ALU）、多路选择器、寄存器及位移寄存器等

2. 控制器

   CPU是计算机的核心，运算器属于执行部件控制器是指挥各部分协同工作

3. 控制寄存器

   CPU内部有许多寄存器

   （1）通用寄存器

   是一组可编程访问的机油多种功能的寄存器的统称，对用户来说是可以操作的有各种各样的功能

   （2）控制寄存器

   ①程序计数器（Program Count，PC）为了保证程序能自动连续执行，在当前指令结束后执行下一条

   ②指令寄存器IR用于存放现行指令，执行指令时现将指令从内存中取出然后放入IR之后送人指令译码器ID中

   ③程序状态标志寄存器PSW，显示程序执行状态如进位、溢出等

   （3）主存接口寄存器

   是CPU与主存进行交换数据的寄存器，主要包括主存地址寄存器MAR和主存数据寄存器MDR



#### 5.1.3 时序系统和时序控制方式

 在计算机中，一条指令的读取与执行过程一般需要分成读取指令、译码、执行、存放结果等步骤

这时候就需要一种时间划分的信号标志如周期、节拍等

1. 时序系统

   （1）机器周期（CPU周期）

   （2）时钟周期（节拍）

   （3）工作脉冲

2. 时序控制方式

   执行一条指令的过程是通过执行一个确定的具体操作序列来实现的
   
   （1）同步控制方式
   
   按照最长操作的所需时间进行决定
   
   （2）异步控制
   
   缺点是逻辑结构比较复杂，一条指令执行完就执行下一条不受时钟周期调节
   
   （3）联合控制
   
   两种方式进行结合，确定操作步骤的按同步，不确定的按异步，一般用异步更合适



### 5.2 指令的执行过程

#### 5.2.1 概述

对于冯诺依曼体系结构的计算机来说，当程序进入内存之后，既可以由计算机自动完成指令和执行指令的任务，控制器负责并协调控制计算机的各部分执行程序，取指令、分析指令（译码）和执行指令

（1）分析指令包括两部分，其一是要完成什么操作

其二是操作数的地址

（2）执行指令就是根据分析产生的操作指令和操作地址让对应的部分进行执行



#### 5.2.2 具体执行过程

深入了解CPU执行指令的工作机制

1. 指令执行中的数据传输通道

   为了便于分析，设定CPU中包含存储器地址寄存器MAR，存储器数据寄存器MDR，程序计数器PC和指令寄存器IR

   （1）取指周期的数据流

   PC-MAR-BUS-AD-MDR-IR-PC+1

   （2）间址周期的数据流

   AD(MDR)-MAR-BUS-AD-MDR

   （3）执行周期的数据流

   R-R形式：两寄存器之间

   R-S形式：寄存器与存储器之间

   S-R形式

2. 指令的执行过程

   机器内部设有存放固定程序的只读存储器（ROM）利用上电复位（Reset）使计算机处于初始状态并从ROM中固定程序开始执行，这是将固定程序的入口地址装入PC中，reset将地址送入PC中，之后进行PC+1



### 5.3 控制器的组成和工作原理

#### 5.3.1 控制器概述

 控制器一般由程序计数器PC、指令寄存器IR、指令译码器ID、时序控制部件和微操作信号形成部件组成PC：用于存放下一条指令

IR：存放当前指令

ID：对IR中指令进行译码

时序控制部件进行时间顺序桉排



#### 5.3.2 微程序控制器

微程序设计思想是采用存储器程序来解决微操作命令序列的形成，具体的实现过程是将一条机器指令编写成一个微程序，每一个微程序都包含若干条微指令。

1. 微控制器概述
1. 微程序控制器的组成及工作原理
1. 微控制器的设计与实现



#### 5.3.3 组合逻辑控制器

1. 组合逻辑控制器组成
2. 指令执行过程
3. 组合逻辑设计步骤
4. 微程序控制于组合逻辑控制的比较



### 5.4 指令流水线

指令流水线是多条指令并行执行的一种实现技术

#### 5.4.1 指令流水线概述

1. 流水线的定义和特点

   通常计算机都是顺序逐条执行程序中的各条指令，分为四个部分取指令、指令译码、执行、存储结果

   前两个过程称为指令部分后两个部分称为执行部分

   顺序执行的特点是结构简单但是部件利用率低，流水线指的是在执行部分执行第一条指令时指令部分就去取第二条指令

   特点：

   （1）流水线可以划分为若干个互有联系的子任务

   （2）流水线处理需要准备时间

   （3）流水线的各功能的时间段应该相等

   （4）指令流一但不能顺序执行的时候就会中断（断流）

   （5）流水技术适用于大量重复的程序过程

2. 流水线的分类

   （1）按应用场合

   + 部件级
   + 处理机级
   + 处理机间流水线

   （2）按完成的功能

   + 单功能流水线
   + 多功能流水线

   （3）按工作方式

   + 静态流水
   + 动态流水

   （4）按流水线的结构

   + 线性流水线
   + 非线性流水线

3. 性能指标

   （1）吞吐率

   单位时间内完成的任务数或输出结果

   （2）流水线的加速比

   完成同一批任务不采用流水线和采用流水线的比值称为加速比

   （3）流水线的效率

   流水线的设备利用率称为流水线的效率



#### 5.4.2 流水线基本工作原理

把一个重复的过程分解为若干的子过程一起运行

（1）顺序执行方式

传统的冯诺依曼的执行方式

（2）n次（n级）重叠执行方式

将多条指令同时进行如四级指令流水每次可执行四条指令



#### 5.4.3 流水线中的相关问题

1. 结构相关

   由于多条指令在同一时刻争用同一资源产生的冲突称为结构相关

2. 数据相关

   后续指令需要前面指令的数据结果

3. 控制相关

   在遇到条件转移指令时要判断是循序执行还是进行跳转

当流水线出现相关问题时可采用流水线停顿、编译检测和定向技术来解决



#### 5.4.4 超标量流水线技术

通常将流水线的功能段的数量称为流水线的深度或级数。（super pipe lining）主要体现时间上的进一步重叠，将流水线的功能进一步的细分（八段以上）

超标量流水线是在CPU内部集成了两条或两条以上能够同时执行的指令流水线



## 第六章 总线

### 6.1 总线概述

#### 6.1.1 总线的基本概念

#### 6.1.2 系统总线的结构

#### 6.1.3 总线仲裁

#### 6.1.4 典型的总线标准

### 6.2 总线信息传输

#### 6.2.1 总线的操作

#### 6.2.2 信息传输方式

#### 6.2.3 总线定时方式

### 6.3 总线仲裁

#### 6.3.1 总线仲裁的概念

#### 6.3.2 总线仲裁方式



